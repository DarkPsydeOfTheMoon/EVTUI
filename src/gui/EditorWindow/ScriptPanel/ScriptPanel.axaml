<rxui:ReactiveUserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:c="clr-namespace:CalcBinding;assembly=CalcBindingAva"
             xmlns:rxui="http://reactiveui.net"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:AvalonEdit="using:AvaloniaEdit"
             xmlns:views="using:EVTUI.Views"
             xmlns:vm="using:EVTUI.ViewModels"
             x:DataType="vm:ScriptPanelViewModel"
             x:Class="EVTUI.Views.ScriptPanel"
             x:TypeArguments="vm:ScriptPanelViewModel">

  <UserControl.Styles>
    <Style Selector="Separator.formtitle">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}"/>
      <Setter Property="Height" Value="2"/>
      <Setter Property="Margin" Value="20,5,20,15"/>
    </Style>
    <Style Selector="Separator.formsubtitle">
      <Setter Property="Margin" Value="40,5,40,15"/>
    </Style>
    <Style Selector="FlyoutPresenter">
      <Setter Property="MaxHeight" Value="700"/>
      <Setter Property="MaxWidth" Value="900"/>
    </Style>
    <Style Selector="StackPanel.form">
      <Setter Property="Orientation" Value="Vertical"/>
      <Setter Property="Spacing" Value="10"/>
    </Style>
    <Style Selector="TextBlock.formtitle">
      <Setter Property="FontSize" Value="24"/>
      <Setter Property="FontWeight" Value="Normal"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
    </Style>
    <Style Selector="TextBlock.formsubtitle">
      <Setter Property="FontSize" Value="20"/>
      <Setter Property="FontWeight" Value="Light"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
      <Setter Property="Margin" Value="0,20,0,0"/>
    </Style>
    <Style Selector="StackPanel.field">
      <Setter Property="HorizontalAlignment" Value="Right"/>
      <Setter Property="Orientation" Value="Horizontal"/>
      <Setter Property="Spacing" Value="20"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
    <Style Selector="TextBlock.fieldtitle">
      <Setter Property="FontSize" Value="16"/>
      <Setter Property="FontWeight" Value="ExtraLight"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
    <Style Selector="AvalonEdit|TextEditor">
      <Setter Property="FontFamily" Value="Monospace"/>
      <Setter Property="FontSize" Value="14"/>
      <Setter Property="FontWeight" Value="Light"/>
      <Setter Property="Margin" Value="0 20 0 20"/>
      <Setter Property="HorizontalAlignment" Value="Stretch"/>
      <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
      <Setter Property="ShowLineNumbers" Value="True"/>
      <Setter Property="VerticalAlignment" Value="Stretch"/>
      <Setter Property="VerticalScrollBarVisibility" Value="Visible"/>
      <Setter Property="WordWrap" Value="True"/>
    </Style>
  </UserControl.Styles>

  <UserControl.DataTemplates>

    <!-- FIELD TYPES -->

    <DataTemplate DataType="{x:Type vm:BoolChoiceField}">
      <StackPanel Classes="field">
        <TextBlock Classes="fieldtitle" Text="{Binding Name}"/>
        <CheckBox
          IsChecked="{Binding Value}"
          IsEnabled="{Binding Editable}"/>
      </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:StringSelectionField}">
      <StackPanel Classes="field">
        <TextBlock Classes="fieldtitle" Text="{Binding Name}"/>
        <ComboBox
          ItemsSource="{Binding Choices}"
          SelectedItem="{Binding Choice}"
          IsEnabled="{Binding Editable}"
          MaxDropDownHeight="300"/>
      </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:IntSelectionField}">
      <StackPanel Classes="field">
        <TextBlock Classes="fieldtitle" Text="{Binding Name}"/>
        <ComboBox
          ItemsSource="{Binding Choices}"
          SelectedItem="{Binding Choice}"
          IsEnabled="{Binding Editable}"
          MaxDropDownHeight="300"/>
      </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:NumEntryField}">
      <StackPanel Classes="field">
        <TextBlock Classes="fieldtitle" Text="{Binding Name}"/>
        <NumericUpDown
          Minimum="{Binding LowerLimit}"
          Maximum="{Binding UpperLimit}"
          Increment="{Binding Increment}"
          Value="{Binding Value}"
          IsEnabled="{Binding Editable}" AllowSpin="true"/>
      </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:StringEntryField}">
      <StackPanel Classes="field">
        <TextBlock Classes="fieldtitle" Text="{Binding Name}"/>
        <TextBox
          AcceptsReturn="true"
          Text="{Binding Text}"
          MaxLength="{Binding MaxLength}"
          IsEnabled="{Binding Editable}"/>
      </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:NumRangeField}">
      <StackPanel Classes="field">
        <TextBlock Classes="fieldtitle" Text="{Binding Name}"/>
        <NumericUpDown
          Minimum="{Binding LowerLimit}"
          Maximum="{Binding UpperLimit}"
          Increment="{Binding Increment}"
          Value="{Binding Value}"
          IsEnabled="{Binding Editable}"
          AllowSpin="true"
          VerticalAlignment="Center"/>
        <Slider
          Minimum="{Binding LowerLimit}"
          Maximum="{Binding UpperLimit}"
          TickFrequency="{Binding Increment}" IsSnapToTickEnabled="{Binding Increment}"
          Value="{Binding Value}"
          IsEnabled="{Binding Editable}"
          Width="200"/>
      </StackPanel>
    </DataTemplate>

  </UserControl.DataTemplates>

    <DockPanel VerticalAlignment="Top">
      <DockPanel DockPanel.Dock="Top">
        <Button ToolTip.Tip="Script Settings" DockPanel.Dock="Right">
          <Button.Flyout>
            <Flyout>
              <StackPanel Classes="form">
                <TextBlock Classes="formtitle" Text="Script Settings"/>
                <Separator Classes="formtitle"/>
                <ContentControl Content="{Binding EmbedBMD}"/>
                <ContentControl Content="{Binding BMDPath}" IsVisible="{Binding EmbedBMD.Value}"/>
                <ContentControl Content="{Binding EmbedBF}"/>
                <ContentControl Content="{Binding BFPath}" IsVisible="{Binding EmbedBF.Value}"/>
                <ContentControl Content="{Binding InitScriptEnabled}"/>
                <ContentControl Content="{Binding InitScriptIndex}" IsVisible="{Binding InitScriptEnabled.Value}"/>
              </StackPanel>
            </Flyout>
          </Button.Flyout>
          <PathIcon Data="{StaticResource settings_regular}" />
        </Button>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
          <Button Click="Compile"
           IsEnabled="{c:Binding HasDecompiledFiles and Editable}"
           Margin="10"
           ToolTip.Tip="Compile Script">
            <PathIcon Data="{StaticResource wrench_regular}"/>
          </Button>
          <ComboBox Name="CompiledName"
           ItemsSource="{Binding ScriptNames}"
           SelectedItem="{Binding SelectedCompiledScriptName}"
           Margin="10"
           MaxDropDownHeight="300"
           Width="NaN"/>
          <ComboBox Name="DecompiledExt"
           IsEnabled="{Binding HasDecompiledFiles}"
           ItemsSource="{Binding ScriptExtNames}"
           SelectedItem="{Binding SelectedDecompiledScriptName}"
           Margin="10"
           MaxDropDownHeight="300"
           Width="NaN"/>
        </StackPanel>
      </DockPanel>
      <TextBox DockPanel.Dock="Bottom"
       Height="200"
       IsReadOnly="True"
       TextWrapping="Wrap"
       Text="{Binding CompilationLogs}"
       CaretIndex="{Binding CompilationLogs.Length}"/>
      <ContentControl Name="EditorContainer"/>
    </DockPanel>

</rxui:ReactiveUserControl>
